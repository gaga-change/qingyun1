<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> - - </title>
    <script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery/jquery-3.1.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #my_canvas {
            background-color: #383838;
            /*background-color: #aa5123;*/
        }

        #svg {
            position: absolute;
            top: 0px;
            left: 0px;
        }

        #svg_text {
            background-color: rgba(255, 255, 255, 0);
            position: absolute;
            top: 300px;
            right: 0px;
            display: none;
            color: #aa5123;
        }

        #wrapper {
            width: 800px;
            height: 800px;
            margin: 20px auto;
            position: relative;
            box-shadow: 2px 10px 10px #2e221b;
            background-color: AliceBlue;
        }

        #pep1 {
            position: absolute;
            top: 0;
            left: 20px;
        }

        #pep2 {
            display: none;
            position: absolute;
            top: 0;
            right: 20px;
        }

        #haha {
            display: none;
        }

        svg.music {
            position: absolute;
            top: 0;
            bottom: 0;
        }

        .my_music {
            width: 23px;
            height: 24px;
            display: block;
            cursor: pointer;
        }

    </style>
</head>
<body>
<div id="wrapper">
    <canvas id='my_canvas' width="800" height="800"></canvas>
    <svg id="svg" width="800" height="200">
        <g id="moon">
            <defs>
                <mask id="mask-moon">
                    <circle r="50" cx="700" cy="100" fill="white"/>
                    <circle r="50" cx="675" cy="120" fill="black"/>
                </mask>
            </defs>
            <circle r="50" cx="700" cy="100" fill="AliceBlue" mask="url(#mask-moon)"/>
        </g>
        <g id="star-group"></g>
        <defs>
            <!--<polygon id="star" points="0 -10 2 -2 10 0 2 2 0 10 -2 2 -10 0 -2 -2" fill="white"/>-->
            <!--<path id="star" stroke-dasharray="none" id="svg_1" d="M204.34249877929688,144.96025040235418 C209.3242950439453,132.27275076743263 228.84249877929688,144.96025040235418 204.34249877929688,161.2727499329676 C179.84249877929688,144.96025040235418 199.36070251464844,132.27275076743263 204.34249877929688,144.96025040235418 z" style="pointer-events:inherit" stroke-width="1.5" stroke="#000" fill="#fff"></path>-->
            <path id="star" stroke-dasharray="none" id="svg_2"
                  d="M21.730011343590377,14.97524642944336 C25.491675505272724,4.912747383117676 40.22999963459006,14.97524642944336 21.730011343590377,27.912748336791992 C3.2300000187092337,14.97524642944336 17.968343261247355,4.912747383117676 21.730011343590377,14.97524642944336 z"
                  style="pointer-events:inherit" stroke-width="1.5" stroke="#000" fill="#fff"></path>
        </defs>
    </svg>
    <svg id="svg_text" width="200" height="300">
        <defs>
            <path id="p1" d="M 0 20  L100,40 " fi ll="none" stroke="blue"
                  stroke-width="3"/>
        </defs>
        <text>
            <textPath xlink:href="#p1" fill="green" style=" color: #aa5123;font-size: 20px">
                weina最美丽
            </textPath>
        </text>
        <defs>
            <path id="p2" d="M 0 60  L200 100 " fill="none" stroke="blue"
                  stroke-width="3"/>
        </defs>
        <text>
            <textPath class="beautiful" xlink:href="#p2" fill="DeepPink" stroke="" style="font-size:30px;font-family:'STKaiti'">
                weina最漂亮
            </textPath>
        </text>
        <defs>
            <path id="p3" d="M 0 100  L200 140 " fill="none" stroke="blue"
                  stroke-width="3"/>
        </defs>
        <text>
            <textPath xlink:href="#p3" style="font-size:20px" fill="green">
                最爱weina老师
            </textPath>
        </text>
    </svg>
    <!--人一-->
    <svg id="pep1" width="100" height="170">
        <g>
            <circle cx="50" cy="45" r="25" stroke="green" fill="none" stroke-width="5"></circle>
            <polyline points="0,120 50,70 100,120" stroke="green" fill="none" stroke-width="5"></polyline>
            <line x1="25" y1="95" x2="25" y2="170" stroke="green" fill="none" stroke-width="5"></line>
            <line x1="75" y1="95" x2="75" y2="170" stroke="green" fill="none" stroke-width="5"></line>
        </g>
        <path id="haha" d="M37 57
        C 37,57 50,70 62,57
    " style="stroke-width: 2" fill="none" stroke="white"/>
    </svg>
    <!--人二-->
    <svg id="pep2" width="100" height="170">
        <g>
            <circle cx="50" cy="45" r="25" stroke="Pink" fill="none" stroke-width="5"></circle>
            <polyline points="0,120 50,70 100,120" stroke="Pink" fill="none" stroke-width="5"></polyline>
            <line x1="25" y1="95" x2="25" y2="170" stroke="Pink" fill="none" stroke-width="5"></line>
            <line x1="75" y1="95" x2="75" y2="170" stroke="Pink" fill="none" stroke-width="5"></line>
        </g>
    </svg>
    <svg class="music" width="800" height="800" xmlns="http://www.w3.org/2000/svg">
        <!-- Created with Method Draw - http://github.com/duopixel/Method-Draw/ -->
        <defs>
            <path id="music"
                  d="m8.470993,40.283352c-2.020975,-0.304642 -2.717865,-2.432816 -1.51298,-3.707851c1.599102,-1.971878 5.019665,-3.301201 7.699696,-2.056961c0.053432,-6.943882 0.022568,-13.888155 0.030754,-20.83217c6.682543,-1.123734 13.37958,-2.189655 20.064665,-3.303623c-0.014492,7.78252 -0.028984,15.565077 -0.043476,23.347601c-1.047241,2.353912 -4.431297,3.986202 -7.377941,3.256298c-1.754253,-0.437737 -2.174801,-2.325146 -1.197971,-3.481594c1.337749,-1.725121 3.827503,-2.909515 6.330589,-2.586399c0.714314,-0.060223 1.766148,0.903713 1.464249,-0.186733c0,-5.455145 0,-10.91029 0,-16.365404c-6.134335,1.029282 -12.280731,2.009697 -18.417885,3.027878c-0.020908,6.348127 0.05216,12.697195 -0.054649,19.044538c-0.195311,1.927986 -2.415524,3.24337 -4.48805,3.757301c-0.8188,0.115105 -1.671341,0.186516 -2.497,0.08712l0,0zm16.001972,-25.881189c3.151852,-0.51701 6.305141,-1.027796 9.455612,-1.550562c0.400909,-1.331369 -1.393394,-0.466745 -2.270882,-0.43421c-5.38158,0.885487 -10.766254,1.75787 -16.147003,2.646812c-0.400909,1.331348 1.393393,0.466724 2.27088,0.434223c2.230223,-0.366383 4.460779,-0.731506 6.691393,-1.096264l0,0z"
                  stroke-width="1.5" stroke="purple" fill="#fff"/>
        </defs>
        <g id="music-group"></g>
    </svg>
</div>
<audio class="audio_music" ></audio>

</body>

<script>
    var myCanvas = document.getElementById("my_canvas");
    var ctx = myCanvas.getContext("2d");
    var fruit = [];
    var temp = Math.PI / 2;
    temp = temp - Math.PI / 4;
    var ran = Math.random();
    console.log("temp" + (temp + Math.PI / 2 * ran) / Math.PI)
    drawTree(ctx, 400, 780, Math.PI * 0.5, 70, 8, 12)
    function drawTree(ctx, startX, startY, angle, length, width, depth, eleColor) {
        if (depth == 6 && fruit.length < 4 && eleColor == undefined) {
            var temp = true;
            fruit.map(function (ele, index) {
                if (Math.abs(startX - ele[0]) < 100)
                    temp = false;
            });
            if (temp) {
                ctx.beginPath();
                ctx.lineCap = "round";
                ctx.lineWidth = 1;
                ctx.moveTo(startX, startY);
                ctx.lineTo(startX, 700);
                ctx.strokeStyle = '#aa965a';
                ctx.stroke();
                fruit.push([startX, 700]);
            }
            return;

        }
        if (depth == 11)length = 30;
        if (depth == 10)length = 50;
        if (depth == 9)length = 60;
        if (depth == 8)length = 80;
        if (depth == 3)length = 60;
        if (depth < 0)return;
//        if (startY>680&&depth<8)return;
        depth--;
        var ran = Math.random();
        var endX, endY;
        endX = startX + length * Math.cos(angle);
        endY = startY - length * Math.sin(angle);
        ctx.beginPath();
        ctx.lineCap = "round";
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.lineWidth = width;
        if (depth > 2) {
            ctx.strokeStyle = '#aa965a';
        } else if (depth == 1) {
            ctx.strokeStyle = 'purple';
        } else {
            ctx.strokeStyle = '#ff95c4';
        }
        if (eleColor != null) {

            ctx.strokeStyle = eleColor;
            if (depth <= 1)
                ctx.strokeStyle = "#ff6259";
        }
        ctx.stroke();
        depth++;
//        angle=angle-Math.PI/4+Math.PI/2*ran;
        var angles = [angle, angle, angle];
        var bool;
        switch (depth) {
            case 12:
                break;
            case 11:
                angles[0] = angle;
                angles[1] = angle - Math.PI * 5 / 12;
                angles[2] = angle + Math.PI * 5 / 12;
                break;
            case 10:

            case 9:
            case 8:
//                angle+=Math.PI/30;
                angle > Math.PI / 2 ? (angle -= Math.PI / 20 ) : (angle += Math.PI / 20);
                angles[0] = angle;
                angles[1] = angle > Math.PI / 2 ? (angle - Math.PI / 8 ) : (angle + Math.PI / 8);
                angles[2] = angle > Math.PI / 2 ? (angle - Math.PI / 4 ) : (angle + Math.PI / 4);
                break;
            case 7:
            case 6:
            case 5:
            case 4:
//                if (startY <600) {
                angle = Math.PI / 2;
//                    length=100;
                if (startX < 400) {
                    angles[0] = Math.PI / 2 + Math.PI / Math.PI / 3;
                    angles[1] = Math.PI / 2 + Math.PI / Math.PI / 2;
                    angles[2] = Math.PI / 2 + Math.PI / Math.PI / 1;
                } else {
                    angles[0] = Math.PI / 2 - Math.PI / Math.PI / 3;
                    angles[1] = Math.PI / 2 - Math.PI / Math.PI / 2;
                    angles[2] = Math.PI / 2 - Math.PI / Math.PI / 1;
                }

                break;
            case 3:
            case 2:

            case 1:
            case 0:
                if (startY < 450) {
                    angle = Math.PI / 2;
                    if (startX < 400) {
                        angles[0] = random(0, Math.PI / 2 + Math.PI / Math.PI / 2);
                        angles[1] = random(0, Math.PI / 2 + Math.PI / Math.PI / 2);
                        angles[2] = random(0, Math.PI / 2 + Math.PI / Math.PI / 2);
                    } else {
                        angles[0] = random(0, Math.PI / 2 + Math.PI / Math.PI / 2);
                        angles[1] = random(0, Math.PI / 2 + Math.PI / Math.PI / 2);
                        angles[2] = random(0, Math.PI / 2 + Math.PI / Math.PI / 2);
                    }

                } else {
                    angle > Math.PI / 2 ? (angle -= Math.PI / 10 ) : (angle += Math.PI / 10);
                    angles[0] = angle;
                    angles[1] = angle > Math.PI / 2 ? (angle - Math.PI / 8 ) : (angle + Math.PI / 8);
                    angles[2] = angle > Math.PI / 2 ? (angle - Math.PI / 4 ) : (angle + Math.PI / 4);
                }
                break;
            default:
                angles[0] = [angle - Math.PI / 4 + Math.PI / 2 * ran];
                angles[1] = [angle - Math.PI / 4 + Math.PI / 2 * ran];
                angles[2] = [angle - Math.PI / 4 + Math.PI / 2 * ran];
        }
        depth--;

        if (depth > 0) {
            setTimeout(function () {
                drawTree(ctx, endX, endY, angles[0], length / 2 + length / 2 * ran, width * 0.5, depth, eleColor);
            }, 100);
            setTimeout(function () {
                drawTree(ctx, endX, endY, angles[1], length / 2 + length / 2 * ran, width * 0.5, depth, eleColor);
            }, 100);
        }
        if (depth >= 7 && depth <= 11) {
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 1 * 0.5, 4, "green");
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 1 * 0.5, 4, "green");
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 2 * 0.5, 4, "green");
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 0.2 * 0.5, 4, "#61ffc8");
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 0.2 * 0.5, 4, "AliceBlue");
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 0.2 * 0.5, 4, "yellow");
            drawTree(ctx, endX, endY, random(0, Math.PI), 100, 0.2 * 0.5, 4, "pink");
        }
        drawTree(ctx, endX, endY, angles[2], length / 2 + length / 2 * ran, width * 0.5, depth, eleColor);

    }
    function con(a, b) {
        console.log(a + ":" + b);
    }

    //星星
    var SVG_NS = 'http://www.w3.org/2000/svg';
    var XLINK_NS = 'http://www.w3.org/1999/xlink';
    var starCount = 100;
    renderStar();
    function renderStar() {
        var starRef = document.querySelector('#star');
        var starGroup = document.querySelector('#star-group');
        while (starCount--) {
            console.log("f")
            star = use(starRef);
            star.setAttribute('transform', 'translate(' + random(0, 800) + ',' + random(200, 0) + ')' + 'scale(' + random(0.1, 0.8) + ')');
            star.setAttribute('opacity', random(0.1, 0.7))
            star.setAttribute('class', "my_star")
            starGroup.appendChild(star)
        }
    }
    var ifRenderMusic = false
    setInterval(function () {
//        console.log($(".my_star"))
        var stars = $(".my_star");
        for (var i = 0; i < stars.length; i++) {
            $(stars[i]).fadeToggle(random(0, 3000));
        }

        //加上是否产生果实的判断
        if (fruit.length == 4 && !ifRenderMusic) {
            renderMusic();
            ifRenderMusic = true;
        }

    }, 1000);


    function use(origon) {
        var _use = document.createElementNS(SVG_NS, 'use');
        _use.setAttributeNS(XLINK_NS, 'xlink:href', '#' + origon.id);
        return _use;
    }
    //大小数之间的随机
    function random(min, max) {
        return min + (max - min) * Math.random();
    }

    //两个人向靠近
    var pep1 = $("#pep1");
    var pep2 = $("#pep2");
    setTimeout(function () {
        pep2.fadeIn("slow");
    }, 200);
    setTimeout(function () {
        pep1.animate({
            "left": "300px"
        }, "slow")
        pep2.animate({
            "right": "300px"
        }, "slow")
        $("#svg_text").fadeToggle("slow");
    }, 1000);
    //        setTimeout(function () {
    //            pep1.animate({
    //                "left":"350px"
    //            },"slow")
    //            pep2.animate({
    //                "right":"350px"
    //            },"slow")
    //        },6000);
    setTimeout(function () {
        $("#haha").fadeIn("slow");
    }, 2000)
    //音乐
    var starCount = 4;
    var jqMusics = new $();
    var nowPlayIndex=1;
    var musics=["/music/one.mp3","/music/two.mp3","/music/three.mp3","/music/four.mp3"]
    function renderMusic() {
        var music = document.querySelector('#music');
        var musicGroup = document.querySelector('#music-group');
        console.log(music)
        console.log(musicGroup)
        fruit.map(function (ele, index) {
            var temp;
            temp = use(music);
            temp.setAttribute('transform', 'translate(' + (ele[0] - 20) + ',' + (ele[1] - 13) + ')' + 'scale(' + 0.8 + ')');
            temp.setAttribute('class', "my_music")
            temp.setAttribute('title', index)
            temp.setAttribute('fill', "yellow")
            temp.style.display = "none"
            musicGroup.appendChild(temp);
        });
        jqMusics = $("#music-group .my_music");
        jqMusics.fadeIn("slow");

        $("audio.audio_music").get(0).src=musics[nowPlayIndex];
        $("audio.audio_music").get(0).play();
       setInterval(function () {
           $("#music-group .my_music").not($("#music-group .my_music").eq(nowPlayIndex)).show("fast");
           console.log(nowPlayIndex);
           console.log( $("#music-group .my_music").eq(nowPlayIndex))
           $("#music-group .my_music").eq(nowPlayIndex).fadeToggle(500);
           $(".beautiful").fadeToggle(500);
       },500);

        $("#music-group .my_music").on("click", function (event) {
            var index = jqMusics.index($(event.currentTarget));
            console.log(index);
            $("audio.audio_music").get(0).src=musics[index];
            $("audio.audio_music").get(0).play();
            nowPlayIndex=index;
        })

    }


</script>
</html>